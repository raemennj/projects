<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Buscador de Factores
  </title>
  <link href="https://use.typekit.net/iwc3riw.css" rel="stylesheet"/>
	 <link href="styles/fff4-4.styles.css" rel="stylesheet"/>
  <style>
   /* Base Styles */
  </style>
 </head>
 <body>
  <div class="calculator" id="calculator">
   <h1>
    Buscador de Factores
   </h1>
   <!-- Input for custom starting mark -->
   <div class="input-section">
    <label for="startingMark">
    Marca de inicio en pulgadas:
    </label>
    <input id="startingMark" placeholder="e.g., 0.5, 1, 1 1/4" type="text" value="1"/>
   </div>
   <!-- Input for total board length -->
   <div class="input-section">
    <label for="boardLength">
     Longitud total de la tabla en pulgadas:
    </label>
    <input id="boardLength" placeholder="e.g., 69 7/16" type="text"/>
   </div>
   <!-- Dropdown for selecting the segment range -->
   <div class="dropdown-section">
    <label for="segmentRange">
     Rango de segmento:
    </label>
    <select id="segmentRange">
      <option value="near-8">
       Casi 8"
      </option>
      <option value="near-10">
       Casi 10"
      </option>
      <option value="near-12">
       Casi 12"
      </option>
      <option value="near-14">
       Casi 14"
      </option>
      <option value="near-16">
       Casi 16"
      </option>
      <option value="parts-3">
       3 Partes
      </option>
      <option value="parts-4">
       4 Partes
      </option>
      <option value="parts-5">
       5 Partes
      </option>
      <option value="parts-6">
       6 Partes
      </option>
      <option value="parts-7">
       7 Partes
      </option>
    </select>
   </div>
   <!-- Div to display results -->
   <div class="results-section">
    <h2>
     Factores:
    </h2>
    <div id="results">
     <!-- Results will be populated here -->
    </div>
   </div>
  </div>
  <script>
    // Previous JavaScript code for calculating markings can be here.
    
    // Debounce function
    function debounce(func, wait) {
        let timeout;
        return function() {
            const context = this, args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                func.apply(context, args);
            }, wait);
        };
    }

    // Function to find the Greatest Common Divisor (GCD) for reducing fractions
    function gcd(a, b) {
        while (b) {
            let temp = a;
            a = b;
            b = temp % a;
        }
        return a;
    }

    function calculateMarkings() {
      // Capture the custom starting mark from user input
      const startingMarkInput = document.getElementById('startingMark').value || "1";
      const [wholeStart, fractionStart] = startingMarkInput.split(" ");
      let startingMark = parseFloat(wholeStart);
      
      if (fractionStart) {
        try {
          const [numerator, denominator] = fractionStart.split("/").map(Number);
          if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
            startingMark += numerator / denominator;
          }
        } catch (error) {
          console.error("Invalid starting mark input:", error);
        }
      }

      // Capture the total board length from user input
      const boardLengthInput = document.getElementById('boardLength').value;
      const [whole, fraction] = boardLengthInput.split(" ");
      let boardLength = parseFloat(whole);
      
      if (fraction) {
        try {
          const [numerator, denominator] = fraction.split("/").map(Number);
          if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
              boardLength += numerator / denominator;
          }
        } catch (error) {
          console.error("Invalid fraction input:", error);
        }
      }

      // Adjust the distance between the two starting marks
      const distance = boardLength - (2 * startingMark);

      // Capture the segment range from the dropdown
      const segmentOption = document.getElementById('segmentRange').value;
      const [type, value] = segmentOption.split("-");

      let numSegments, segmentLength;

      if (type === "near") {
        numSegments = Math.round(distance / parseInt(value));
        if (numSegments < 1) numSegments = 1;
        segmentLength = distance / numSegments;
      } else if (type === "parts") {
        numSegments = parseInt(value);
        segmentLength = distance / numSegments;
      }

      // Generate the markings
      let markings = [];
      for (let i = 0; i <= numSegments; i++) {
        const mark = startingMark + (i * segmentLength);
        const wholePart = Math.floor(mark);
        const fractionPart = (mark - wholePart);
        const denominator = 16;
        const numerator = Math.round(fractionPart * denominator);
        const commonDivisor = gcd(numerator, denominator);
        const reducedNumerator = numerator / commonDivisor;
        const reducedDenominator = denominator / commonDivisor;

        if (fractionPart === 0) {
            markings.push(`${wholePart}"`);
        } else {
            markings.push(`${wholePart} <span class='fraction'><sup>${reducedNumerator}</sup>/<sub>${reducedDenominator}</sub></span>`);
        }
      }

      // Ensure the first result starts at 1 inch
      //if (markings.length === 0 || !markings[0].includes('1"')) {
      //  markings.unshift('1"');
      //}
      
      // Display the results
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = markings.join('<br>');
    }

    // The debounced version of calculateMarkings
    const debouncedCalculateMarkings = debounce(calculateMarkings, 500);

    // Attach event listener to the 'boardLength' input field
    document.getElementById('boardLength').addEventListener('input', debouncedCalculateMarkings);

    // Attach event listener to the 'segmentRange' dropdown
    document.getElementById('segmentRange').addEventListener('change', debouncedCalculateMarkings);

    // Attach event listener to the 'startingMark' input field
    document.getElementById('startingMark').addEventListener('input', debouncedCalculateMarkings);

  </script>
 </body>
</html>
