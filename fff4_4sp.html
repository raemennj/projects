<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Buscador de Factores
  </title>
  <link href="https://use.typekit.net/iwc3riw.css" rel="stylesheet"/>
  <link href="styles/fff4-4.styles.css" rel="stylesheet"/>
  <style>
   /* Base Styles */
  </style>
 </head>
 <body>
  <div class="calculator" id="calculator">
   <h1>
    <id class="deco">l</id>Buscador de Factores 
   </h1>
   <div class="input-container">
     <div class="input-section-a">
      <label for="boardLength">
        Longitud:
      </label>
      <input id="boardLength" type="text"/>
     </div>
     <div class="input-section-b">
      <label for="startingMark">
        Quemar:
      </label>
      <input id="startingMark" type="text" value="1"/>
     </div>
     <div class="">
      <label for="customType">
        MÃ©todo:
      </label>
      <select class="methodDropdown" id="customType" onchange="toggleCustomInput()">
        <option value="near">Casi</option>
        <option value="parts">Partes</option>
      </select>
      <input type="text" class="methodInput" id="customValueNear" style="display:block;" />
      <input type="text" class="methodInput" id="customValueParts" style="display:none;" />
     </div>
   </div>
   <div class="results-section">
    <h2>
     Factores:
    </h2>
    <div id="results">
    </div>
   </div>
  </div>
  <script>
    function debounce(func, wait) {
        let timeout;
        return function() {
            const context = this, args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                func.apply(context, args);
            }, wait);
        };
    }

    function gcd(a, b) {
        while (b) {
            let temp = a;
            a = b;
            b = temp % a;
        }
        return a;
    }

    function toggleCustomInput() {
      const customType = document.getElementById('customType').value;
      if (customType === "near") {
        document.getElementById('customValueNear').style.display = "block";
        document.getElementById('customValueParts').style.display = "none";
      } else if (customType === "parts") {
        document.getElementById('customValueNear').style.display = "none";
        document.getElementById('customValueParts').style.display = "block";
      }
    }

    function calculateMarkings() {
      const startingMarkInput = document.getElementById('startingMark').value;
      let startingMark = parseFloat(startingMarkInput);
      
      const boardLengthInput = document.getElementById('boardLength').value;
      let boardLength = parseFloat(boardLengthInput);
      
      const distance = boardLength - (2 * startingMark);
      
      const customType = document.getElementById('customType').value;
      let customValueInput = "";
      if (customType === "near") {
        customValueInput = document.getElementById('customValueNear').value;
      } else if (customType === "parts") {
        customValueInput = document.getElementById('customValueParts').value;
      }
      let customValue = parseFloat(customValueInput);

      if (customValueInput.includes('/')) {
        const [numerator, denominator] = customValueInput.split("/").map(Number);
        if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
          customValue = numerator / denominator;
        }
      }

      let numSegments, segmentLength;

      if (customType === "near") {
        numSegments = Math.round(distance / customValue);
        if (numSegments < 1) numSegments = 1;
        segmentLength = distance / numSegments;
      } else if (customType === "parts") {
        numSegments = customValue;
        segmentLength = distance / numSegments;
      }

      let markings = [];
      for (let i = 0; i <= numSegments; i++) {
        const mark = startingMark + (i * segmentLength);
        const wholePart = Math.floor(mark);
        const fractionPart = (mark - wholePart);
        const denominator = 16;
        const numerator = Math.round(fractionPart * denominator);
        const commonDivisor = gcd(numerator, denominator);
        const reducedNumerator = numerator / commonDivisor;
        const reducedDenominator = denominator / commonDivisor;

        if (fractionPart === 0) {
          markings.push(`${wholePart}"`);
        } else {
          markings.push(`${wholePart} <span class='fraction'><sup>${reducedNumerator}</sup>/<sub>${reducedDenominator}</sub></span>`);
        }
      }
      
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = markings.join('<br>');
    }

    const debouncedCalculateMarkings = debounce(calculateMarkings, 500);
    document.getElementById('boardLength').addEventListener('input', debouncedCalculateMarkings);
    document.getElementById('startingMark').addEventListener('input', debouncedCalculateMarkings);
    document.getElementById('customValueNear').addEventListener('input', debouncedCalculateMarkings);
    document.getElementById('customValueParts').addEventListener('input', debouncedCalculateMarkings);
    document.getElementById('customType').addEventListener('change', debouncedCalculateMarkings);
  </script>
 </body>
</html>
