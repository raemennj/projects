<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Buscador de Factores
  </title>
  <link href="https://use.typekit.net/iwc3riw.css" rel="stylesheet"/>
  <link href="styles/fff4-4.styles.css" rel="stylesheet"/>
  <style>
   /* Base Styles */
  </style>
 </head>
 <body>
  <div class="calculator" id="calculator">
   <h1>
    Buscador de Factores
   </h1>
   <div class="input-container">
     <div class="input-section-a">
      <input id="boardLength" type="text" placeholder="p.ej., 69 7/16"/>
      <label for="boardLength">
       Longitud:
      </label>
     </div>
     <div class="input-section-b">
      <input id="startingMark" type="text" value="1" placeholder="p.ej., 0.5, 1, 1 1/4"/>
      <label for="startingMark">
      quemar:
      </label>
     </div>
     <div class="dropdown-section">
      <select id="segmentRange">
        <option value="near-8">Casi 8"</option>
        <option value="near-10">Casi 10"</option>
        <option value="near-12">Casi 12"</option>
        <option value="near-14">Casi 14"</option>
        <option value="near-16">Casi 16"</option>
        <option value="parts-3">3 Partes</option>
        <option value="parts-4">4 Partes</option>
        <option value="parts-5">5 Partes</option>
        <option value="parts-6">6 Partes</option>
        <option value="parts-7">7 Partes</option>
      </select>
      <label for="segmentRange">
       Segmento:
      </label>
     </div>
   </div>
   <div class="results-section">
    <h2>
     Factores:
    </h2>
    <div id="results">
    </div>
   </div>
  </div>
  <script>
    function debounce(func, wait) {
        let timeout;
        return function() {
            const context = this, args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                func.apply(context, args);
            }, wait);
        };
    }

    function gcd(a, b) {
        while (b) {
            let temp = a;
            a = b;
            b = temp % a;
        }
        return a;
    }

    function calculateMarkings() {
      const startingMarkInput = document.getElementById('startingMark').value;
      let startingMark = 0;

      if (startingMarkInput === "0") {
          startingMark = 0;
      } else if (startingMarkInput.includes('/')) {
        const [wholeStart, fractionStart] = startingMarkInput.split(" ");
        if (fractionStart || wholeStart.includes('/')) {
          const [numerator, denominator] = (fractionStart || wholeStart).split("/").map(Number);
          if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
            startingMark += numerator / denominator;
          }
        }

        if (wholeStart && !wholeStart.includes('/')) {
          startingMark += parseFloat(wholeStart);
        }
      } else {
        startingMark = startingMarkInput ? parseFloat(startingMarkInput) : 1;
      }

      const boardLengthInput = document.getElementById('boardLength').value;
      const [whole, fraction] = boardLengthInput.split(" ");
      let boardLength = parseFloat(whole);
      
      if (fraction) {
        try {
          const [numerator, denominator] = fraction.split("/").map(Number);
          if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
            boardLength += numerator / denominator;
          }
        } catch (error) {
          console.error("Invalid fraction input:", error);
        }
      }

      const distance = boardLength - (2 * startingMark);
      const segmentOption = document.getElementById('segmentRange').value;
      const [type, value] = segmentOption.split("-");

      let numSegments, segmentLength;

      if (type === "near") {
        numSegments = Math.round(distance / parseInt(value));
        if (numSegments < 1) numSegments = 1;
        segmentLength = distance / numSegments;
      } else if (type === "parts") {
        numSegments = parseInt(value);
        segmentLength = distance / numSegments;
      }

      let markings = [];
      for (let i = 0; i <= numSegments; i++) {
        const mark = startingMark + (i * segmentLength);
        const wholePart = Math.floor(mark);
        const fractionPart = (mark - wholePart);
        const denominator = 16;
        const numerator = Math.round(fractionPart * denominator);
        const commonDivisor = gcd(numerator, denominator);
        const reducedNumerator = numerator / commonDivisor;
        const reducedDenominator = denominator / commonDivisor;

        if (fractionPart === 0) {
          markings.push(`${wholePart}"`);
        } else {
          markings.push(`${wholePart} <span class='fraction'><sup>${reducedNumerator}</sup>/<sub>${reducedDenominator}</sub></span>`);
        }
      }
      
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = markings.join('<br>');
    }

    const debouncedCalculateMarkings = debounce(calculateMarkings, 500);
    document.getElementById('boardLength').addEventListener('input', debouncedCalculateMarkings);
    document.getElementById('segmentRange').addEventListener('change', debouncedCalculateMarkings);
    document.getElementById('startingMark').addEventListener('input', debouncedCalculateMarkings);
  </script>
 </body>
</html>