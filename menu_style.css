/* ================== Responsive Reflow (Feature-flagged) ================== */
.responsive-mode {
  /* Global scale + rhythm (tweak if you like) */
  --scale: 1;
  --gap: clamp(6px, 1.2vw, 12px);
  --key-radius: 12px;

  /* Font scales (kept conservative so text stays legible on SE-sized phones) */
  --font-display: clamp(1rem, 4.2vw, 1.6rem);
  --font-key:     clamp(0.95rem, 3.2vw, 1.15rem);
  --font-small:   clamp(0.85rem, 2.5vw, 1rem);
}

/* Viewport wrapper: full-bleed, safe-area aware, scroll when tiny */
.responsive-mode .calc-viewport {
  position: relative;
  margin: 0 auto;
  padding:
    env(safe-area-inset-top)
    env(safe-area-inset-right)
    calc(env(safe-area-inset-bottom) + 0px)
    env(safe-area-inset-left);
  width: 100%;
  height: 100vh; /* fallback */
  overflow: auto;               /* allow vertical scroll if we must */
  overscroll-behavior-y: contain;
}

/* Prefer dynamic viewport units where supported (iOS bars, etc.) */
@supports (height: 100dvh) {
  .responsive-mode .calc-viewport { height: 100dvh; }
}

/* On wider screens, add breathing room around the viewport */
@media (min-width: 600px) {
  .responsive-mode .calc-viewport {
    padding:
      calc(env(safe-area-inset-top) + var(--gap))
      calc(env(safe-area-inset-right) + var(--gap))
      calc(env(safe-area-inset-bottom) + var(--gap))
      calc(env(safe-area-inset-left) + var(--gap));
  }
}

/* The calculator “board” becomes a responsive grid. */
.responsive-mode .calc-board {
  display: grid;
  gap: var(--gap);
  grid-template-areas:
    "display"
    "memory"
    "keypad"
    "tools";
  grid-auto-rows: min-content;
  align-content: start;
  max-width: 960px;       /* looks nice on desktops/tablets */
  margin: 0 auto;
}

/* Area mapping (non-invasive) */
.responsive-mode .calc-board [data-area="display"] { grid-area: display; }
.responsive-mode .calc-board [data-area="memory"]  { grid-area: memory; }
.responsive-mode .calc-board [data-area="keypad"]  { grid-area: keypad; }
.responsive-mode .calc-board [data-area="tools"]   { grid-area: tools; }

/* Display/readout sizing */
.responsive-mode [data-area="display"] {
  font-size: var(--font-display);
  line-height: 1.25;
  padding: calc(var(--gap) * 1.0);
  border-radius: var(--key-radius);
  min-height: 3.2em;           /* room for big numbers */
  display: flex;
  flex-direction: column;
  gap: var(--gap);
}

/* Memory strip: allow wrapping on narrow screens */
.responsive-mode [data-area="memory"] {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: 1fr;
  gap: var(--gap);
  /* When too narrow, drop into 2 rows automatically */
  grid-template-rows: repeat(2, minmax(44px, auto));
}

/* Keypad: touch-friendly grid */
.responsive-mode [data-area="keypad"] {
  display: grid;
  gap: var(--gap);
  /* 5 columns for this keypad */
  grid-template-columns: repeat(5, minmax(44px, 1fr));
  grid-auto-rows: minmax(44px, 1fr);
  align-items: stretch;
}

/* Tools row (Feet toggle, etc.) */
.responsive-mode [data-area="tools"] {
  display: grid;
  grid-auto-flow: column;
  gap: var(--gap);
  grid-auto-columns: minmax(44px, 1fr);
}

/* Generic button sizing (keeps your existing button classes intact) */
.responsive-mode .calc-board button,
.responsive-mode .calc-board .key {
  min-height: 44px;
  min-width: 44px;
  font-size: var(--font-key);
  border-radius: var(--key-radius);
  line-height: 1.1;
}

/* On very narrow screens, allow memory to wrap more aggressively */
@media (max-width: 360px) {
  .responsive-mode [data-area="memory"] {
    grid-auto-flow: row;
    grid-template-columns: repeat(3, minmax(44px, 1fr));
    grid-template-rows: repeat(2, minmax(44px, auto));
  }
}

/* Landscape / larger screens: optional two-column layout */
@media (min-width: 900px) and (min-height: 520px) {
  .responsive-mode .calc-board {
    grid-template-areas:
      "display display"
      "keypad  memory"
      "keypad  tools";
    grid-template-columns: 2fr 1fr;
    align-items: start;
  }
  .responsive-mode [data-area="memory"],
  .responsive-mode [data-area="tools"] {
    grid-auto-flow: row;
    grid-auto-rows: minmax(44px, auto);
  }
}

/* Modal behavior */
.responsive-mode .modal-open { overflow: hidden; }

.responsive-mode .modal {
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

.responsive-mode .modal__content {
  max-height: min(80vh, 80dvh);
  overflow: auto;
}

/* Respect users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
  .responsive-mode * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
}
